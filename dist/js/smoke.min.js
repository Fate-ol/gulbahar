!function(e,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof module&&module.exports?(module.exports=n(),module.exports.default=module.exports):e.smokemachine=e.SmokeMachine=n()}("undefined"!=typeof self?self:this,(function(){var e=[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,3,5,5,7,4,4,1,1,0,1,0,0,0,0,0,1,0,0,17,27,41,52,56,34,23,15,11,4,9,5,1,0,0,0,0,0,0,1,45,63,57,45,78,66,52,41,34,37,23,20,0,1,0,0,0,0,1,43,62,66,64,67,115,112,114,56,58,47,33,18,12,10,0,0,0,0,39,50,63,76,87,107,105,112,128,104,69,64,29,18,21,15,0,0,0,7,42,52,85,91,103,126,153,128,124,82,57,52,52,24,1,0,0,0,2,17,41,67,84,100,122,136,159,127,78,69,60,50,47,25,7,1,0,0,0,34,33,66,82,113,138,149,168,175,82,142,133,70,62,41,25,6,0,0,0,18,39,55,113,111,137,141,139,141,128,102,130,90,96,65,37,0,0,0,2,15,27,71,104,129,129,158,140,154,146,150,131,92,100,67,26,3,0,0,0,0,46,73,104,124,145,135,122,107,120,122,101,98,96,35,38,7,2,0,0,0,50,58,91,124,127,139,118,121,177,156,88,90,88,28,43,3,0,0,0,0,30,62,68,91,83,117,89,139,139,99,105,77,32,1,1,0,0,0,0,0,16,21,8,45,101,125,118,87,110,86,64,39,0,0,0,0,0,0,0,0,0,1,28,79,79,117,122,88,84,54,46,11,0,0,0,0,0,0,0,0,0,1,0,6,55,61,68,71,30,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,23,25,20,12,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,12,9,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,2,2,0,0,0,0,0,0,0,0],n=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;function t(e,n){return e+Math.random()*(n-e)}function a(e,n,a){(a=a||{}).lifetime;var i={x:e,y:n,vx:t(a.minVx||-.04,a.maxVx||.04),startvy:t(a.minVy||-.4,a.maxVy||-.1),scale:t(a.minScale||0,a.maxScale||.5),lifetime:t(a.minLifetime||2e3,a.maxLifetime||8e3),age:0};return i.finalScale=t(a.minScale||25+i.scale,a.maxScale||30+i.scale),i.vy=i.startvy,i}return function(t,i){var o=function(n){n=n||[24,46.8,48.2];for(var t=document.createElement("canvas"),a=t.getContext("2d"),i=a.createImageData(20,20),o=i.data,r=0;r<o.length;r+=4)o[r]=n[0],o[r+1]=n[1],o[r+2]=n[2],o[r+3]=e[r/4];return t.width=20,t.height=20,a.putImageData(i,0,0),t}(i),r=[],c=function(){};function f(e){t.clearRect(0,0,t.canvas.width,t.canvas.height),r.forEach((function(n){!function(e,n){e.x+=e.vx*n,e.y+=e.vy*n;var t=Math.sqrt(e.age/e.lifetime);e.vy=(1-t)*e.startvy,e.age+=n,e.scale=t*e.finalScale}(n,e)})),r=r.filter((function(e){return e.age<e.lifetime})),c(e,r),r.forEach((function(e){!function(e,n,t){t.globalAlpha=(1-Math.abs(1-2*e.age/e.lifetime))/40;var a=20*e.scale/2,i=e.x-a,o=i+2*a,r=e.y-a,c=r+2*a;t.drawImage(n,i,r,o-i,c-r)}(e,o,t)}))}var m=!1,u=performance.now();function l(e){if(m){var t=e-u;u=e,f(t),n(l)}}function s(e,n,t,i){if((t=t||10)<1)return Math.random()<=t&&r.push(a(e,n,i));for(var o=0;o<t;o++)r.push(a(e,n,i))}return{step:function(e){e=e||16,console.log(e),f(e)},start:function(){m=!0,u=performance.now(),n(l)},setPreDrawCallback:function(e){c=e},stop:function(){m=!1},addsmoke:s,addSmoke:s}}}));